#!/bin/bash
# auto_fix.sh - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å –∫–æ–¥–æ–º

set -e

echo "üîß –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å –∫–æ–¥–æ–º..."
echo "=============================================="

# –ü—Ä–æ–≤–µ—Ä—è–µ–º Poetry
if ! command -v poetry &> /dev/null; then
    echo "‚ùå Poetry –Ω–µ –Ω–∞–π–¥–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Poetry —Å–Ω–∞—á–∞–ª–∞."
    exit 1
fi

echo "üì¶ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏..."
poetry install --no-interaction

echo ""
echo "üé® –ü—Ä–∏–º–µ–Ω—è–µ–º Black —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ..."
echo "-----------------------------------"
poetry run black tests/ app/ || echo "Black –∑–∞–≤–µ—Ä—à–µ–Ω"

echo ""
echo "üìã –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –ø–æ—Ä—è–¥–æ–∫ –∏–º–ø–æ—Ä—Ç–æ–≤..."
echo "-------------------------------"
poetry run isort tests/ app/ || echo "isort –∑–∞–≤–µ—Ä—à–µ–Ω"

echo ""
echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å flake8..."
echo "--------------------------------"
poetry run flake8 tests/ app/ || {
    echo ""
    echo "‚ö†Ô∏è  –û—Å—Ç–∞–ª–∏—Å—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å flake8."
    echo "–°–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ, —ç—Ç–æ –º–æ–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º —Ñ–∞–π–ª–æ–≤ —Ç–µ—Å—Ç–æ–≤."
}

echo ""
echo "üß™ –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏..."
echo "-------------------------------"
poetry run pytest tests/ --tb=short -q

echo ""
echo "‚úÖ –ê–≤—Ç–æ–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"
echo ""
echo "üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:"
echo "1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã –∏–∑ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤"
echo "2. –û–±–Ω–æ–≤–∏—Ç–µ pyproject.toml —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π flake8"
echo "3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ: ./quality_check.sh"
